package OJx::Pline;

use strict;
use utf8;
use Carp;

########################################################################################
##
########################################################################################
sub new {
    my $self = shift;
    my $class = ref($self) || $self;
    bless {}, $class;
}

########################################################################################
##
########################################################################################
sub match {
    my $self = shift;
    my($pat, $cmds) = @_;
    my $dat;

    if ($cmds->{T}) {
        $dat = $self->T;
        if ($pat =~ /[a-z]/i) {
            ### WHat was this for? -dji
        }
    }
    elsif ($cmds->{M}) {
        $dat = $cmds->{slash} ? $self->P : $self->M;
        $dat =~ s/^\d\d ?[MP]//; ## remove the line no and type code
        $dat =~ s/\[.*?\]//g;    ## remove contraction-elided segments
    }
    elsif ($cmds->{G}) {
        $dat = $self->G;
    }
    $dat =~ /$pat/i;
}

########################################################################################
##
########################################################################################
sub T {
    my $self = shift;
    if (my $val = shift) {
        $self->{T} = $val;
    }
    $self->{T};
}

########################################################################################
##
########################################################################################
sub M {
    my $self = shift;
    if (my $val = shift) {
        $self->{M} = $val;
        $val =~ s/\[.*?\]//g; ## remove contraction-elided segments
        $val =~ s/\s|[-.]//g; ## remove whitespace and boundary markers
        $self->{P} = $val;
    }
    $self->{M};
}

########################################################################################
##
########################################################################################
sub G {
    my $self = shift;
    if (my $val = shift) {
        $self->{G} = $val;
    }
    $self->{G};
}

########################################################################################
##
########################################################################################
sub P {
    my $self = shift;
    croak "P is a read-only property" if shift;
    $self->{P};
}

########################################################################################
##
########################################################################################
sub toString {
    my $self = shift;
    $self->{T} . "\n" .
    $self->{M} . "\n" .
    $self->{G};
}

1;
__END__
